<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Admin ‚Äî CSA</title>
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/icons.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/pages.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/admin.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå±</text></svg>">
</head>
<body>
  <div id="app-header"></div>

  <div class="admin-layout" id="admin-app">
    <!-- Sidebar rendered by JS -->
    <aside class="admin-sidebar" id="admin-sidebar"></aside>
    <!-- Main content rendered by JS -->
    <main class="admin-main" id="admin-main"></main>
  </div>

  <!-- Modals -->
  <div class="admin-modal-overlay" id="modal-overlay">
    <div class="admin-modal" id="modal-container"></div>
  </div>

  <div class="lesson-editor-overlay" id="lesson-overlay">
    <div class="lesson-editor" id="lesson-container"></div>
  </div>

  <script src="js/icons.js"></script>
  <script src="js/data.js"></script>
  <script src="js/app.js"></script>
  <script src="js/admin-store.js"></script>
  <script>
    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    document.getElementById('app-header').innerHTML = renderHeader('');
    initNotifications();

    // Check admin auth
    const auth = AdminStore.getAuth();
    if (!auth || auth.role !== 'admin') {
      window.location.href = 'login.html';
    }

    // ‚îÄ‚îÄ State ‚îÄ‚îÄ
    let currentSection = 'dashboard';
    let editingProduct = null;
    let editingCourse = null;
    let editingLessonCtx = null; // {courseId, sectionId, lessonId}
    let editingRecipe = null;
    let editingUser = null;

    const ICON_OPTIONS = ['apple','plant','leaf','farm','seed','sun','waterDrop','wheat','recipe','tractor'];
    const GRADIENT_OPTIONS = ['green','yellow','cream','brown','orange','purple','red','blue'];
    const CATEGORY_OPTIONS = ['cestas','hortalicas','laticinios','conservas','graos','bebidas'];
    const COURSE_CATEGORY_OPTIONS = ['horta','pecuaria','solo','agroecologia','processamento','tecnologia'];
    const LEVEL_OPTIONS = ['Iniciante','Intermedi√°rio','Avan√ßado'];
    const RECIPE_CATEGORY_OPTIONS = ['saladas','sopas','paes','conservas','pratos','bebidas','lanches','sobremesas'];
    const DIFFICULTY_OPTIONS = ['F√°cil','Intermedi√°rio','Avan√ßado'];
    const USER_ROLE_OPTIONS = ['user','admin'];
    const USER_CATEGORY_OPTIONS = ['produtor','educador','parceiro','consumidor','admin'];

    // ‚îÄ‚îÄ Render Sidebar ‚îÄ‚îÄ
    function renderSidebar() {
      document.getElementById('admin-sidebar').innerHTML = `
        <div class="admin-sidebar-header">
          <h3>Administra√ß√£o</h3>
          <div class="admin-badge">${Icons.lock(12)} Admin</div>
        </div>
        <nav class="admin-nav">
          <button class="admin-nav-item ${currentSection === 'dashboard' ? 'active' : ''}" onclick="navigateTo('dashboard')">
            ${Icons.home(18)} Dashboard
          </button>
          <button class="admin-nav-item ${currentSection === 'products' ? 'active' : ''}" onclick="navigateTo('products')">
            ${Icons.marketplace(18)} Produtos
          </button>
          <button class="admin-nav-item ${currentSection === 'courses' ? 'active' : ''}" onclick="navigateTo('courses')">
            ${Icons.course(18)} Cursos
          </button>
          <button class="admin-nav-item ${currentSection === 'recipes' ? 'active' : ''}" onclick="navigateTo('recipes')">
            ${Icons.recipe(18)} Receitas
          </button>
          <div class="admin-nav-divider"></div>
          <button class="admin-nav-item ${currentSection === 'orders' ? 'active' : ''}" onclick="navigateTo('orders')">
            ${Icons.cart(18)} Pedidos
          </button>
          <button class="admin-nav-item ${currentSection === 'users' ? 'active' : ''}" onclick="navigateTo('users')">
            ${Icons.users(18)} Usu√°rios
          </button>
          <button class="admin-nav-item ${currentSection === 'members' ? 'active' : ''}" onclick="navigateTo('members')">
            ${Icons.members(18)} Integrantes
          </button>
          <div class="admin-nav-divider"></div>
          <button class="admin-nav-item" onclick="window.location.href='index.html'" style="color:var(--text-muted);">
            ${Icons.externalLink(18)} Ver Site
          </button>
          <button class="admin-nav-item" onclick="AdminStore.logout();window.location.href='login.html'" style="color:var(--error);">
            ${Icons.lock(18)} Sair
          </button>
        </nav>
      `;
    }

    // ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
    function navigateTo(section) {
      currentSection = section;
      renderSidebar();
      renderMain();
    }

    // ‚îÄ‚îÄ Render Main Content ‚îÄ‚îÄ
    function renderMain() {
      const main = document.getElementById('admin-main');
      switch(currentSection) {
        case 'dashboard': renderDashboard(main); break;
        case 'products':  renderProductsPage(main); break;
        case 'courses':   renderCoursesPage(main); break;
        case 'recipes':   renderRecipesPage(main); break;
        case 'orders':    renderOrdersPage(main); break;
        case 'users':     renderUsersPage(main); break;
        case 'members':   renderMembersPage(main); break;
        default:          renderDashboard(main);
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DASHBOARD
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderDashboard(el) {
      const products = AdminStore.getProducts();
      const courses = AdminStore.getCourses();
      const recipes = AdminStore.getRecipes();
      const users = AdminStore.getUsers();
      const activeProducts = products.filter(p => p.status === 'active').length;
      const activeCourses = courses.filter(c => c.status === 'active').length;
      const activeRecipes = recipes.filter(r => r.status === 'active').length;
      const totalStock = products.reduce((s, p) => s + (p.stock || 0), 0);
      const totalStudents = courses.reduce((s, c) => s + (c.students || 0), 0);
      const activeUsers = users.filter(u => u.status === 'active').length;

      el.innerHTML = `
        <div class="admin-topbar">
          <div>
            <h1>Dashboard</h1>
            <p style="color:var(--text-muted);font-size:var(--font-size-sm);">Vis√£o geral da plataforma CSA</p>
          </div>
          <div class="admin-topbar-actions">
            <button class="btn btn-primary" onclick="openProductModal()">
              ${Icons.plus(16)} Novo Produto
            </button>
            <button class="btn btn-dark" onclick="openCourseModal()">
              ${Icons.plus(16)} Novo Curso
            </button>
            <button class="btn btn-outline" onclick="openRecipeModal()">
              ${Icons.plus(16)} Nova Receita
            </button>
          </div>
        </div>

        <div class="admin-stats" style="grid-template-columns:repeat(6,1fr);">
          <div class="admin-stat-card fade-in-up stagger-1">
            <div class="admin-stat-icon green">${Icons.marketplace(24)}</div>
            <div class="admin-stat-info">
              <strong>${activeProducts}</strong>
              <span>Produtos</span>
            </div>
          </div>
          <div class="admin-stat-card fade-in-up stagger-2">
            <div class="admin-stat-icon blue">${Icons.course(24)}</div>
            <div class="admin-stat-info">
              <strong>${activeCourses}</strong>
              <span>Cursos</span>
            </div>
          </div>
          <div class="admin-stat-card fade-in-up stagger-3">
            <div class="admin-stat-icon orange">${Icons.recipe(24)}</div>
            <div class="admin-stat-info">
              <strong>${activeRecipes}</strong>
              <span>Receitas</span>
            </div>
          </div>
          <div class="admin-stat-card fade-in-up stagger-4">
            <div class="admin-stat-icon purple">${Icons.users(24)}</div>
            <div class="admin-stat-info">
              <strong>${activeUsers}</strong>
              <span>Usu√°rios</span>
            </div>
          </div>
          <div class="admin-stat-card fade-in-up stagger-5">
            <div class="admin-stat-icon green">${Icons.apple(24)}</div>
            <div class="admin-stat-info">
              <strong>${totalStock}</strong>
              <span>Estoque</span>
            </div>
          </div>
          <div class="admin-stat-card fade-in-up stagger-6">
            <div class="admin-stat-icon blue">${Icons.members(24)}</div>
            <div class="admin-stat-info">
              <strong>${totalStudents.toLocaleString('pt-BR')}</strong>
              <span>Alunos</span>
            </div>
          </div>
        </div>

        <!-- Recent Products -->
        <div class="admin-table-wrapper fade-in-up stagger-5">
          <div class="admin-table-header">
            <h3>${Icons.marketplace(20)} Produtos Recentes</h3>
            <button class="btn btn-ghost btn-sm" onclick="navigateTo('products')">Ver todos ${Icons.chevronRight(14)}</button>
          </div>
          <table class="admin-table">
            <thead>
              <tr><th>Produto</th><th>Pre√ßo</th><th>Estoque</th><th>Status</th><th>A√ß√µes</th></tr>
            </thead>
            <tbody>
              ${products.slice(0, 4).map(p => `
                <tr>
                  <td><div class="td-product"><div class="td-icon ${p.gradient || 'green'}">${Icons[p.icon] ? Icons[p.icon](20) : Icons.apple(20)}</div><div><div class="td-name">${p.name}</div><div class="td-sub">${p.producer || 'CSA'}</div></div></div></td>
                  <td><strong>${formatBRL(p.price)}</strong></td>
                  <td>${(p.stock||0) < 20 ? '<span style="color:var(--error);font-weight:600;">' + (p.stock||0) + '</span>' : (p.stock||0)}</td>
                  <td><span class="status-badge ${p.status || 'active'}">${p.status === 'draft' ? 'Rascunho' : p.status === 'inactive' ? 'Inativo' : 'Ativo'}</span></td>
                  <td class="td-actions">
                    <button class="admin-action-btn" onclick="openProductModal(${p.id})">${Icons.edit(14)}</button>
                    <button class="admin-action-btn danger" onclick="confirmDeleteProduct(${p.id})">${Icons.trash(14)}</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--space-6);">
        <!-- Recent Courses -->
        <div class="admin-table-wrapper fade-in-up stagger-6">
          <div class="admin-table-header">
            <h3>${Icons.course(20)} Cursos Recentes</h3>
            <button class="btn btn-ghost btn-sm" onclick="navigateTo('courses')">Ver todos ${Icons.chevronRight(14)}</button>
          </div>
          <table class="admin-table">
            <thead>
              <tr><th>Curso</th><th>Alunos</th><th>Status</th></tr>
            </thead>
            <tbody>
              ${courses.slice(0, 4).map(c => `
                <tr>
                  <td><div class="td-course"><div class="td-icon ${c.gradient || 'green'}">${Icons[c.icon] ? Icons[c.icon](20) : Icons.course(20)}</div><div><div class="td-name">${c.title}</div><div class="td-sub">${c.instructor || ''}</div></div></div></td>
                  <td>${(c.students||0).toLocaleString('pt-BR')}</td>
                  <td><span class="status-badge ${c.status || 'active'}">${c.status === 'draft' ? 'Rascunho' : 'Ativo'}</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>

        <!-- Recent Recipes -->
        <div class="admin-table-wrapper fade-in-up stagger-7">
          <div class="admin-table-header">
            <h3>${Icons.recipe(20)} Receitas Recentes</h3>
            <button class="btn btn-ghost btn-sm" onclick="navigateTo('recipes')">Ver todas ${Icons.chevronRight(14)}</button>
          </div>
          <table class="admin-table">
            <thead>
              <tr><th>Receita</th><th>Tempo</th><th>Status</th></tr>
            </thead>
            <tbody>
              ${recipes.slice(0, 4).map(r => `
                <tr>
                  <td><div class="td-product"><div class="td-icon ${r.gradient || 'green'}">${Icons[r.icon] ? Icons[r.icon](20) : Icons.recipe(20)}</div><div><div class="td-name">${r.title}</div><div class="td-sub">${r.author || ''} ¬∑ ${r.category || ''}</div></div></div></td>
                  <td>${r.time || '-'}</td>
                  <td><span class="status-badge ${r.status || 'active'}">${r.status === 'draft' ? 'Rascunho' : 'Ativo'}</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        </div>
      `;
      setTimeout(initScrollAnimations, 100);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  PRODUCTS PAGE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderProductsPage(el) {
      const products = AdminStore.getProducts();
      el.innerHTML = `
        <div class="admin-topbar">
          <div>
            <h1>Produtos</h1>
            <p style="color:var(--text-muted);font-size:var(--font-size-sm);">${products.length} produtos cadastrados</p>
          </div>
          <div class="admin-topbar-actions">
            <div class="input-group" style="min-width:220px;">
              <span class="input-icon">${Icons.search(16)}</span>
              <input type="text" placeholder="Buscar produto..." id="product-search" oninput="filterProducts()">
            </div>
            <button class="btn btn-primary" onclick="openProductModal()">
              ${Icons.plus(16)} Novo Produto
            </button>
          </div>
        </div>

        <div class="admin-table-wrapper" id="products-table-wrapper">
          ${renderProductsTable(products)}
        </div>
      `;
    }

    function renderProductsTable(products) {
      if (products.length === 0) {
        return `<div class="admin-empty">
          ${Icons.marketplace(48)}
          <h3>Nenhum produto cadastrado</h3>
          <p>Comece adicionando seu primeiro produto ao marketplace.</p>
          <button class="btn btn-primary" onclick="openProductModal()">${Icons.plus(16)} Adicionar Produto</button>
        </div>`;
      }
      return `
        <table class="admin-table">
          <thead>
            <tr>
              <th>Produto</th>
              <th>Pre√ßo</th>
              <th>Estoque</th>
              <th>Categoria</th>
              <th>Avalia√ß√£o</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            ${products.map(p => `
              <tr>
                <td>
                  <div class="td-product">
                    <div class="td-icon ${p.gradient || 'green'}">${Icons[p.icon] ? Icons[p.icon](20) : Icons.apple(20)}</div>
                    <div>
                      <div class="td-name">${p.name}</div>
                      <div class="td-sub">${p.producer || ''} ¬∑ ${p.location || ''}</div>
                    </div>
                  </div>
                </td>
                <td><strong>${formatBRL(p.price)}</strong> <small style="color:var(--text-muted);">${p.unit || ''}</small></td>
                <td>${(p.stock||0) < 20 ? '<span style="color:var(--error);font-weight:600;">' + (p.stock||0) + '</span>' : (p.stock||0)}</td>
                <td><span class="badge badge-green" style="text-transform:capitalize;">${p.category || '-'}</span></td>
                <td>${renderStars(p.rating || 0)} <small style="color:var(--text-muted);">(${p.reviews || 0})</small></td>
                <td><span class="status-badge ${p.status || 'active'}">${p.status === 'draft' ? 'Rascunho' : p.status === 'inactive' ? 'Inativo' : 'Ativo'}</span></td>
                <td class="td-actions">
                  <button class="admin-action-btn" onclick="openProductModal(${p.id})" data-tooltip="Editar">${Icons.edit(14)}</button>
                  <button class="admin-action-btn" onclick="duplicateProduct(${p.id})" data-tooltip="Duplicar">${Icons.copy(14)}</button>
                  <button class="admin-action-btn danger" onclick="confirmDeleteProduct(${p.id})" data-tooltip="Excluir">${Icons.trash(14)}</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function filterProducts() {
      const q = (document.getElementById('product-search')?.value || '').toLowerCase();
      const products = AdminStore.getProducts().filter(p =>
        p.name.toLowerCase().includes(q) ||
        (p.producer || '').toLowerCase().includes(q) ||
        (p.category || '').toLowerCase().includes(q)
      );
      document.getElementById('products-table-wrapper').innerHTML = renderProductsTable(products);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  PRODUCT MODAL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function openProductModal(id) {
      editingProduct = id ? AdminStore.getProducts().find(p => p.id === id) : null;
      const p = editingProduct || {};
      const isEdit = !!editingProduct;

      document.getElementById('modal-container').innerHTML = `
        <div class="admin-modal-header">
          <h2>${Icons.marketplace(22)} ${isEdit ? 'Editar Produto' : 'Novo Produto'}</h2>
          <button class="admin-action-btn" onclick="closeModal()">${Icons.close(18)}</button>
        </div>
        <div class="admin-modal-body">
          <div class="admin-tabs" id="product-tabs">
            <button class="admin-tab active" onclick="switchProductTab('info')">Informa√ß√µes</button>
            <button class="admin-tab" onclick="switchProductTab('details')">Detalhes</button>
            <button class="admin-tab" onclick="switchProductTab('media')">M√≠dia</button>
          </div>

          <!-- Info Tab -->
          <div id="product-tab-info">
            <div class="admin-form-grid">
              <div class="admin-form-group">
                <label>Nome do Produto <span class="required">*</span></label>
                <input type="text" id="p-name" value="${p.name || ''}" placeholder="Ex: Cesta Org√¢nica Fam√≠lia">
              </div>
              <div class="admin-form-group">
                <label>Produtor</label>
                <input type="text" id="p-producer" value="${p.producer || ''}" placeholder="Ex: S√≠tio Boa Vista">
              </div>
              <div class="admin-form-group">
                <label>Pre√ßo <span class="required">*</span></label>
                <input type="number" id="p-price" value="${p.price || ''}" placeholder="0.00" step="0.01" min="0">
              </div>
              <div class="admin-form-group">
                <label>Unidade</label>
                <select id="p-unit">
                  ${['/unid','/kg','/semana','/200g','/dz','/kit','/lt'].map(u =>
                    `<option value="${u}" ${p.unit === u ? 'selected' : ''}>${u}</option>`
                  ).join('')}
                </select>
              </div>
              <div class="admin-form-group">
                <label>Estoque Dispon√≠vel <span class="required">*</span></label>
                <input type="number" id="p-stock" value="${p.stock || 0}" min="0">
              </div>
              <div class="admin-form-group">
                <label>Categoria</label>
                <select id="p-category">
                  ${CATEGORY_OPTIONS.map(c =>
                    `<option value="${c}" ${p.category === c ? 'selected' : ''}>${c.charAt(0).toUpperCase() + c.slice(1)}</option>`
                  ).join('')}
                </select>
              </div>
              <div class="admin-form-group">
                <label>Status</label>
                <select id="p-status">
                  <option value="active" ${(p.status||'active') === 'active' ? 'selected' : ''}>Ativo</option>
                  <option value="draft" ${p.status === 'draft' ? 'selected' : ''}>Rascunho</option>
                  <option value="inactive" ${p.status === 'inactive' ? 'selected' : ''}>Inativo</option>
                </select>
              </div>
              <div class="admin-form-group">
                <label>Badge / Selo</label>
                <input type="text" id="p-badge" value="${p.badge || ''}" placeholder="Ex: Org√¢nico, Artesanal...">
              </div>
              <div class="admin-form-group full">
                <label>Descri√ß√£o</label>
                <textarea id="p-description" rows="3" placeholder="Descreva o produto em detalhes...">${p.description || ''}</textarea>
              </div>
            </div>
          </div>

          <!-- Details Tab -->
          <div id="product-tab-details" style="display:none;">
            <div class="admin-form-grid">
              <div class="admin-form-group">
                <label>Localiza√ß√£o / Origem</label>
                <input type="text" id="p-location" value="${p.location || ''}" placeholder="Ex: Campinas-SP">
              </div>
              <div class="admin-form-group">
                <label>Avalia√ß√£o (1-5)</label>
                <input type="number" id="p-rating" value="${p.rating || 4.5}" min="1" max="5" step="0.1">
              </div>
              <div class="admin-form-group">
                <label>N¬∫ de Avalia√ß√µes</label>
                <input type="number" id="p-reviews" value="${p.reviews || 0}" min="0">
              </div>
              <div class="admin-form-group">
                <label>Peso / Volume</label>
                <input type="text" id="p-weight" value="${p.weight || ''}" placeholder="Ex: 500g, 1L...">
              </div>
              <div class="admin-form-group full">
                <label>Informa√ß√µes Adicionais</label>
                <textarea id="p-extra" rows="3" placeholder="Informa√ß√µes nutricionais, modo de conserva√ß√£o, certifica√ß√µes...">${p.extra || ''}</textarea>
              </div>
            </div>
          </div>

          <!-- Media Tab -->
          <div id="product-tab-media" style="display:none;">
            <div class="admin-form-grid">
              <div class="admin-form-group">
                <label>√çcone</label>
                <div style="display:flex;gap:var(--space-2);flex-wrap:wrap;">
                  ${ICON_OPTIONS.map(ic => `
                    <button type="button" class="admin-action-btn icon-pick ${(p.icon||'apple') === ic ? 'active' : ''}" data-icon="${ic}" onclick="pickProductIcon('${ic}')" style="${(p.icon||'apple') === ic ? 'border-color:var(--green-primary);background:var(--green-light);color:var(--green-dark);' : ''}" data-tooltip="${ic}">
                      ${Icons[ic](18)}
                    </button>
                  `).join('')}
                </div>
                <input type="hidden" id="p-icon" value="${p.icon || 'apple'}">
              </div>
              <div class="admin-form-group">
                <label>Cor / Gradiente</label>
                <div style="display:flex;gap:var(--space-2);flex-wrap:wrap;">
                  ${GRADIENT_OPTIONS.map(g => `
                    <button type="button" class="admin-action-btn grad-pick" data-gradient="${g}" onclick="pickProductGradient('${g}')" style="width:32px;height:32px;border-radius:50%;${(p.gradient||'green') === g ? 'ring: 2px solid var(--green-primary);box-shadow:0 0 0 2px var(--green-primary);' : ''}" data-tooltip="${g}">
                      <div style="width:20px;height:20px;border-radius:50%;" class="img-placeholder ${g}"></div>
                    </button>
                  `).join('')}
                </div>
                <input type="hidden" id="p-gradient" value="${p.gradient || 'green'}">
              </div>
              <div class="admin-form-group full">
                <label>Imagem do Produto</label>
                <div class="file-upload-area" onclick="showToast('Upload de imagens em breve!','upload')">
                  ${Icons.upload(32)}
                  <p>Clique para fazer upload</p>
                  <span class="file-types">PNG, JPG, WEBP at√© 5MB</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="admin-modal-footer">
          <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
          <button class="btn btn-primary" onclick="saveProduct()">
            ${Icons.check(16)} ${isEdit ? 'Salvar Altera√ß√µes' : 'Criar Produto'}
          </button>
        </div>
      `;
      openModal();
    }

    function switchProductTab(tab) {
      ['info','details','media'].forEach(t => {
        document.getElementById('product-tab-' + t).style.display = t === tab ? 'block' : 'none';
      });
      document.querySelectorAll('#product-tabs .admin-tab').forEach((btn, i) => {
        btn.classList.toggle('active', ['info','details','media'][i] === tab);
      });
    }

    function pickProductIcon(icon) {
      document.getElementById('p-icon').value = icon;
      document.querySelectorAll('.icon-pick').forEach(btn => {
        const isActive = btn.dataset.icon === icon;
        btn.style.borderColor = isActive ? 'var(--green-primary)' : '';
        btn.style.background = isActive ? 'var(--green-light)' : '';
        btn.style.color = isActive ? 'var(--green-dark)' : '';
      });
    }

    function pickProductGradient(gradient) {
      document.getElementById('p-gradient').value = gradient;
      document.querySelectorAll('.grad-pick').forEach(btn => {
        const isActive = btn.dataset.gradient === gradient;
        btn.style.boxShadow = isActive ? '0 0 0 2px var(--green-primary)' : 'none';
      });
    }

    function saveProduct() {
      const name = document.getElementById('p-name').value.trim();
      const price = parseFloat(document.getElementById('p-price').value);
      if (!name) { showToast('Informe o nome do produto!', 'close'); return; }
      if (isNaN(price) || price < 0) { showToast('Informe um pre√ßo v√°lido!', 'close'); return; }

      const data = {
        name,
        price,
        producer: document.getElementById('p-producer').value.trim(),
        unit: document.getElementById('p-unit').value,
        stock: parseInt(document.getElementById('p-stock').value) || 0,
        category: document.getElementById('p-category').value,
        status: document.getElementById('p-status').value,
        badge: document.getElementById('p-badge').value.trim(),
        description: document.getElementById('p-description').value.trim(),
        location: document.getElementById('p-location').value.trim(),
        rating: parseFloat(document.getElementById('p-rating').value) || 4.5,
        reviews: parseInt(document.getElementById('p-reviews').value) || 0,
        weight: document.getElementById('p-weight')?.value.trim() || '',
        extra: document.getElementById('p-extra')?.value.trim() || '',
        icon: document.getElementById('p-icon').value,
        gradient: document.getElementById('p-gradient').value,
      };

      if (editingProduct) {
        AdminStore.updateProduct(editingProduct.id, data);
        showToast('Produto atualizado com sucesso!', 'check');
      } else {
        AdminStore.addProduct(data);
        showToast('Produto criado com sucesso!', 'check');
      }
      closeModal();
      renderMain();
    }

    function confirmDeleteProduct(id) {
      const p = AdminStore.getProducts().find(x => x.id === id);
      if (!p) return;
      if (confirm(`Excluir "${p.name}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
        AdminStore.deleteProduct(id);
        showToast('Produto exclu√≠do!', 'trash');
        renderMain();
      }
    }

    function duplicateProduct(id) {
      const p = AdminStore.getProducts().find(x => x.id === id);
      if (!p) return;
      AdminStore.addProduct({ ...p, name: p.name + ' (C√≥pia)', id: undefined, status: 'draft' });
      showToast('Produto duplicado como rascunho!', 'copy');
      renderMain();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  COURSES PAGE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderCoursesPage(el) {
      const courses = AdminStore.getCourses();
      el.innerHTML = `
        <div class="admin-topbar">
          <div>
            <h1>Cursos</h1>
            <p style="color:var(--text-muted);font-size:var(--font-size-sm);">${courses.length} cursos cadastrados</p>
          </div>
          <div class="admin-topbar-actions">
            <div class="input-group" style="min-width:220px;">
              <span class="input-icon">${Icons.search(16)}</span>
              <input type="text" placeholder="Buscar curso..." id="course-search" oninput="filterCourses()">
            </div>
            <button class="btn btn-primary" onclick="openCourseModal()">
              ${Icons.plus(16)} Novo Curso
            </button>
          </div>
        </div>

        <div class="admin-table-wrapper" id="courses-table-wrapper">
          ${renderCoursesTable(courses)}
        </div>
      `;
    }

    function renderCoursesTable(courses) {
      if (courses.length === 0) {
        return `<div class="admin-empty">
          ${Icons.course(48)}
          <h3>Nenhum curso cadastrado</h3>
          <p>Crie seu primeiro curso com cap√≠tulos e aulas.</p>
          <button class="btn btn-primary" onclick="openCourseModal()">${Icons.plus(16)} Criar Curso</button>
        </div>`;
      }
      return `
        <table class="admin-table">
          <thead>
            <tr>
              <th>Curso</th>
              <th>Pre√ßo</th>
              <th>Alunos</th>
              <th>Estrutura</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            ${courses.map(c => `
              <tr>
                <td>
                  <div class="td-course">
                    <div class="td-icon ${c.gradient || 'green'}">${Icons[c.icon] ? Icons[c.icon](20) : Icons.course(20)}</div>
                    <div>
                      <div class="td-name">${c.title}</div>
                      <div class="td-sub">${c.instructor || ''} ¬∑ ${c.level || ''} ¬∑ ${c.duration || ''}</div>
                    </div>
                  </div>
                </td>
                <td><strong>${c.price > 0 ? formatBRL(c.price) : 'Gr√°tis'}</strong></td>
                <td>${(c.students||0).toLocaleString('pt-BR')}</td>
                <td>
                  <span style="font-size:var(--font-size-xs);">
                    ${(c.sections||[]).length} cap√≠tulos ¬∑
                    ${(c.sections||[]).reduce((s, sec) => s + sec.lessons.length, 0)} aulas
                  </span>
                </td>
                <td><span class="status-badge ${c.status || 'active'}">${c.status === 'draft' ? 'Rascunho' : c.status === 'inactive' ? 'Inativo' : 'Ativo'}</span></td>
                <td class="td-actions">
                  <button class="admin-action-btn" onclick="openCourseModal(${c.id})" data-tooltip="Editar">${Icons.edit(14)}</button>
                  <button class="admin-action-btn danger" onclick="confirmDeleteCourse(${c.id})" data-tooltip="Excluir">${Icons.trash(14)}</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function filterCourses() {
      const q = (document.getElementById('course-search')?.value || '').toLowerCase();
      const courses = AdminStore.getCourses().filter(c =>
        c.title.toLowerCase().includes(q) ||
        (c.instructor || '').toLowerCase().includes(q)
      );
      document.getElementById('courses-table-wrapper').innerHTML = renderCoursesTable(courses);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  COURSE MODAL (with section/lesson builder)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function openCourseModal(id) {
      editingCourse = id ? AdminStore.getCourses().find(c => c.id === id) : null;
      const c = editingCourse || {};
      const isEdit = !!editingCourse;

      document.getElementById('modal-container').innerHTML = `
        <div class="admin-modal-header">
          <h2>${Icons.course(22)} ${isEdit ? 'Editar Curso' : 'Novo Curso'}</h2>
          <button class="admin-action-btn" onclick="closeModal()">${Icons.close(18)}</button>
        </div>
        <div class="admin-modal-body">
          <div class="admin-tabs" id="course-tabs">
            <button class="admin-tab active" onclick="switchCourseTab('info')">Informa√ß√µes</button>
            <button class="admin-tab" onclick="switchCourseTab('content')">Conte√∫do</button>
            <button class="admin-tab" onclick="switchCourseTab('media')">M√≠dia</button>
          </div>

          <!-- Info Tab -->
          <div id="course-tab-info">
            <div class="admin-form-grid">
              <div class="admin-form-group full">
                <label>T√≠tulo do Curso <span class="required">*</span></label>
                <input type="text" id="c-title" value="${c.title || ''}" placeholder="Ex: Horta Org√¢nica em Casa">
              </div>
              <div class="admin-form-group">
                <label>Instrutor <span class="required">*</span></label>
                <input type="text" id="c-instructor" value="${c.instructor || ''}" placeholder="Nome do instrutor">
              </div>
              <div class="admin-form-group">
                <label>Iniciais do Avatar</label>
                <input type="text" id="c-avatar" value="${c.avatar || ''}" placeholder="Ex: MS" maxlength="2">
              </div>
              <div class="admin-form-group">
                <label>Pre√ßo</label>
                <input type="number" id="c-price" value="${c.price || 0}" step="0.01" min="0" placeholder="0 = Gr√°tis">
                <span class="help-text">Use 0 para cursos gratuitos</span>
              </div>
              <div class="admin-form-group">
                <label>Dura√ß√£o</label>
                <input type="text" id="c-duration" value="${c.duration || ''}" placeholder="Ex: 8h, 12h">
              </div>
              <div class="admin-form-group">
                <label>N√≠vel</label>
                <select id="c-level">
                  ${LEVEL_OPTIONS.map(l =>
                    `<option value="${l}" ${c.level === l ? 'selected' : ''}>${l}</option>`
                  ).join('')}
                </select>
              </div>
              <div class="admin-form-group">
                <label>Categoria</label>
                <select id="c-category">
                  ${COURSE_CATEGORY_OPTIONS.map(cat =>
                    `<option value="${cat}" ${c.category === cat ? 'selected' : ''}>${cat.charAt(0).toUpperCase() + cat.slice(1)}</option>`
                  ).join('')}
                </select>
              </div>
              <div class="admin-form-group">
                <label>N¬∫ de M√≥dulos</label>
                <input type="number" id="c-modules" value="${c.modules || 0}" min="0">
              </div>
              <div class="admin-form-group">
                <label>Status</label>
                <select id="c-status">
                  <option value="active" ${(c.status||'active') === 'active' ? 'selected' : ''}>Ativo</option>
                  <option value="draft" ${c.status === 'draft' ? 'selected' : ''}>Rascunho</option>
                  <option value="inactive" ${c.status === 'inactive' ? 'selected' : ''}>Inativo</option>
                </select>
              </div>
              <div class="admin-form-group">
                <label>Badge / Selo</label>
                <input type="text" id="c-badge" value="${c.badge || ''}" placeholder="Ex: Novo, Popular...">
              </div>
              <div class="admin-form-group full">
                <label>Descri√ß√£o do Curso</label>
                <textarea id="c-description" rows="3" placeholder="Descreva o conte√∫do e objetivos do curso...">${c.description || ''}</textarea>
              </div>
            </div>
          </div>

          <!-- Content Tab (Section/Lesson Builder) -->
          <div id="course-tab-content" style="display:none;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-4);">
              <div>
                <h3 style="font-size:var(--font-size-lg);margin:0;">Estrutura do Curso</h3>
                <p style="font-size:var(--font-size-xs);color:var(--text-muted);">Organize cap√≠tulos e aulas</p>
              </div>
            </div>
            <div class="course-builder" id="course-builder">
              ${renderCourseSections(c)}
            </div>
            <button type="button" class="add-section-btn" onclick="handleAddSection()" style="margin-top:var(--space-4);">
              ${Icons.plus(16)} Adicionar Cap√≠tulo
            </button>
          </div>

          <!-- Media Tab -->
          <div id="course-tab-media" style="display:none;">
            <div class="admin-form-grid">
              <div class="admin-form-group">
                <label>√çcone</label>
                <div style="display:flex;gap:var(--space-2);flex-wrap:wrap;">
                  ${ICON_OPTIONS.map(ic => `
                    <button type="button" class="admin-action-btn cicon-pick" data-icon="${ic}" onclick="pickCourseIcon('${ic}')" style="${(c.icon||'plant') === ic ? 'border-color:var(--green-primary);background:var(--green-light);color:var(--green-dark);' : ''}" data-tooltip="${ic}">
                      ${Icons[ic](18)}
                    </button>
                  `).join('')}
                </div>
                <input type="hidden" id="c-icon" value="${c.icon || 'plant'}">
              </div>
              <div class="admin-form-group">
                <label>Cor / Gradiente</label>
                <div style="display:flex;gap:var(--space-2);flex-wrap:wrap;">
                  ${GRADIENT_OPTIONS.map(g => `
                    <button type="button" class="admin-action-btn cgrad-pick" data-gradient="${g}" onclick="pickCourseGradient('${g}')" style="width:32px;height:32px;border-radius:50%;${(c.gradient||'green') === g ? 'box-shadow:0 0 0 2px var(--green-primary);' : ''}" data-tooltip="${g}">
                      <div style="width:20px;height:20px;border-radius:50%;" class="img-placeholder ${g}"></div>
                    </button>
                  `).join('')}
                </div>
                <input type="hidden" id="c-gradient" value="${c.gradient || 'green'}">
              </div>
              <div class="admin-form-group full">
                <label>Imagem de Capa</label>
                <div class="file-upload-area" onclick="showToast('Upload de imagens em breve!','upload')">
                  ${Icons.upload(32)}
                  <p>Clique para fazer upload da capa</p>
                  <span class="file-types">PNG, JPG, WEBP at√© 5MB</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="admin-modal-footer">
          <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
          <button class="btn btn-primary" onclick="saveCourse()">
            ${Icons.check(16)} ${isEdit ? 'Salvar Altera√ß√µes' : 'Criar Curso'}
          </button>
        </div>
      `;
      openModal();
    }

    function switchCourseTab(tab) {
      ['info','content','media'].forEach(t => {
        document.getElementById('course-tab-' + t).style.display = t === tab ? 'block' : 'none';
      });
      document.querySelectorAll('#course-tabs .admin-tab').forEach((btn, i) => {
        btn.classList.toggle('active', ['info','content','media'][i] === tab);
      });
    }

    function pickCourseIcon(icon) {
      document.getElementById('c-icon').value = icon;
      document.querySelectorAll('.cicon-pick').forEach(btn => {
        const isActive = btn.dataset.icon === icon;
        btn.style.borderColor = isActive ? 'var(--green-primary)' : '';
        btn.style.background = isActive ? 'var(--green-light)' : '';
        btn.style.color = isActive ? 'var(--green-dark)' : '';
      });
    }

    function pickCourseGradient(gradient) {
      document.getElementById('c-gradient').value = gradient;
      document.querySelectorAll('.cgrad-pick').forEach(btn => {
        const isActive = btn.dataset.gradient === gradient;
        btn.style.boxShadow = isActive ? '0 0 0 2px var(--green-primary)' : 'none';
      });
    }

    // ‚îÄ‚îÄ Section / Lesson Builder Rendering ‚îÄ‚îÄ
    function renderCourseSections(course) {
      const sections = course.sections || [];
      if (sections.length === 0) {
        return `<div class="admin-empty" style="padding:var(--space-8);">
          ${Icons.course(36)}
          <h3 style="font-size:var(--font-size-base);">Nenhum cap√≠tulo ainda</h3>
          <p>Adicione cap√≠tulos e aulas para estruturar seu curso.</p>
        </div>`;
      }
      return sections.map((section, si) => `
        <div class="course-section">
          <div class="course-section-header">
            <h4>
              <span style="color:var(--muted-gray);font-size:var(--font-size-xs);">‚â°</span>
              <span class="badge badge-green" style="font-size:10px;">Cap ${si + 1}</span>
              ${section.title}
              <small style="color:var(--text-muted);font-weight:400;margin-left:var(--space-2);">(${section.lessons.length} aula${section.lessons.length !== 1 ? 's' : ''})</small>
            </h4>
            <div class="section-actions">
              <button class="admin-action-btn" onclick="editSectionTitle(${si})" data-tooltip="Renomear">${Icons.edit(12)}</button>
              <button class="admin-action-btn danger" onclick="handleDeleteSection(${si})" data-tooltip="Excluir">${Icons.trash(12)}</button>
            </div>
          </div>
          <div class="course-section-body">
            ${section.lessons.map((lesson, li) => `
              <div class="course-lesson">
                <span class="lesson-drag">‚â°</span>
                <div class="lesson-icon ${lesson.type}">
                  ${lesson.type === 'video' ? Icons.eye(16) : lesson.type === 'pdf' ? Icons.download(16) : Icons.edit(16)}
                </div>
                <div class="lesson-info">
                  <span class="lesson-name">${lesson.title}</span>
                  <span class="lesson-meta">
                    ${lesson.type === 'video' ? 'üé• V√≠deo' : lesson.type === 'pdf' ? 'üìÑ PDF' : 'üìù Texto'}
                    ${lesson.duration ? ' ¬∑ ' + lesson.duration : ''}
                    ${lesson.transcription ? ' ¬∑ Transcri√ß√£o ‚úì' : ''}
                    ${lesson.notes ? ' ¬∑ Notas ‚úì' : ''}
                  </span>
                </div>
                <div class="lesson-actions">
                  <button class="admin-action-btn" onclick="openLessonEditor(${si}, ${li})" data-tooltip="Editar aula">${Icons.edit(12)}</button>
                  <button class="admin-action-btn danger" onclick="handleDeleteLesson(${si}, ${li})" data-tooltip="Excluir">${Icons.trash(12)}</button>
                </div>
              </div>
            `).join('')}
            <button type="button" class="add-lesson-btn" onclick="openLessonEditor(${si}, -1)">
              ${Icons.plus(14)} Adicionar Aula
            </button>
          </div>
        </div>
      `).join('');
    }

    // Track temp sections while editing
    function getTempSections() {
      if (editingCourse && editingCourse.sections) return editingCourse.sections;
      if (!editingCourse) {
        if (!window._tempSections) window._tempSections = [];
        return window._tempSections;
      }
      return [];
    }

    function handleAddSection() {
      let sections = getTempSections();
      const newId = sections.length > 0 ? Math.max(...sections.map(s => s.id || 0)) + 1 : 1;
      const title = prompt('Nome do cap√≠tulo:', `Cap√≠tulo ${sections.length + 1}`);
      if (!title) return;
      sections.push({ id: newId, title, lessons: [] });
      if (editingCourse) editingCourse.sections = sections;
      else window._tempSections = sections;
      document.getElementById('course-builder').innerHTML = renderCourseSections({ sections });
    }

    function editSectionTitle(si) {
      let sections = getTempSections();
      const newTitle = prompt('Novo nome:', sections[si].title);
      if (!newTitle) return;
      sections[si].title = newTitle;
      document.getElementById('course-builder').innerHTML = renderCourseSections({ sections });
    }

    function handleDeleteSection(si) {
      let sections = getTempSections();
      if (!confirm(`Excluir "${sections[si].title}" e todas as suas aulas?`)) return;
      sections.splice(si, 1);
      document.getElementById('course-builder').innerHTML = renderCourseSections({ sections });
    }

    function handleDeleteLesson(si, li) {
      let sections = getTempSections();
      if (!confirm(`Excluir a aula "${sections[si].lessons[li].title}"?`)) return;
      sections[si].lessons.splice(li, 1);
      document.getElementById('course-builder').innerHTML = renderCourseSections({ sections });
    }

    // ‚îÄ‚îÄ Lesson Editor ‚îÄ‚îÄ
    function openLessonEditor(sectionIdx, lessonIdx) {
      const sections = getTempSections();
      const isNew = lessonIdx === -1;
      const lesson = isNew ? { title: '', type: 'video', videoUrl: '', content: '', transcription: '', notes: '', duration: '', fileName: '', fileSize: '' } : { ...sections[sectionIdx].lessons[lessonIdx] };
      editingLessonCtx = { sectionIdx, lessonIdx };

      document.getElementById('lesson-container').innerHTML = `
        <div class="admin-modal-header">
          <h2>${isNew ? Icons.plus(20) : Icons.edit(20)} ${isNew ? 'Nova Aula' : 'Editar Aula'}</h2>
          <button class="admin-action-btn" onclick="closeLessonEditor()">${Icons.close(18)}</button>
        </div>
        <div class="admin-modal-body">
          <div class="admin-form-grid">
            <div class="admin-form-group full">
              <label>T√≠tulo da Aula <span class="required">*</span></label>
              <input type="text" id="l-title" value="${lesson.title}" placeholder="Ex: Introdu√ß√£o √† compostagem">
            </div>
            <div class="admin-form-group full">
              <label>Tipo de Conte√∫do</label>
              <div style="display:flex;gap:var(--space-3);">
                <label style="display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3) var(--space-4);border:1px solid var(--border-light);border-radius:var(--radius-md);cursor:pointer;flex:1;font-size:var(--font-size-sm);">
                  <input type="radio" name="l-type" value="video" ${lesson.type === 'video' ? 'checked' : ''} onchange="toggleLessonType()"> üé• V√≠deo
                </label>
                <label style="display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3) var(--space-4);border:1px solid var(--border-light);border-radius:var(--radius-md);cursor:pointer;flex:1;font-size:var(--font-size-sm);">
                  <input type="radio" name="l-type" value="text" ${lesson.type === 'text' ? 'checked' : ''} onchange="toggleLessonType()"> üìù Texto
                </label>
                <label style="display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3) var(--space-4);border:1px solid var(--border-light);border-radius:var(--radius-md);cursor:pointer;flex:1;font-size:var(--font-size-sm);">
                  <input type="radio" name="l-type" value="pdf" ${lesson.type === 'pdf' ? 'checked' : ''} onchange="toggleLessonType()"> üìÑ PDF
                </label>
              </div>
            </div>

            <!-- Video fields -->
            <div id="lesson-video-fields" class="admin-form-group full" style="display:${lesson.type === 'video' ? 'flex' : 'none'}; flex-direction:column; gap:var(--space-4);">
              <div class="admin-form-group">
                <label>URL do V√≠deo</label>
                <input type="url" id="l-videoUrl" value="${lesson.videoUrl || ''}" placeholder="https://youtube.com/watch?v=... ou URL do v√≠deo">
                <span class="help-text">YouTube, Vimeo ou link direto do v√≠deo</span>
              </div>
              <div class="admin-form-group">
                <label>Dura√ß√£o</label>
                <input type="text" id="l-duration" value="${lesson.duration || ''}" placeholder="Ex: 15 min">
              </div>
              <div class="file-upload-area" onclick="showToast('Upload de v√≠deo em breve!','upload')" style="padding:var(--space-6);">
                ${Icons.upload(28)}
                <p>Ou fa√ßa upload do v√≠deo</p>
                <span class="file-types">MP4, MOV, WEBM at√© 500MB</span>
              </div>
            </div>

            <!-- Text fields -->
            <div id="lesson-text-fields" class="admin-form-group full" style="display:${lesson.type === 'text' ? 'flex' : 'none'}; flex-direction:column; gap:var(--space-4);">
              <div class="admin-form-group">
                <label>Conte√∫do da Aula</label>
                <textarea id="l-content" rows="8" placeholder="Escreva o conte√∫do da aula aqui...">${lesson.content || ''}</textarea>
              </div>
            </div>

            <!-- PDF fields -->
            <div id="lesson-pdf-fields" class="admin-form-group full" style="display:${lesson.type === 'pdf' ? 'flex' : 'none'}; flex-direction:column; gap:var(--space-4);">
              <div class="admin-form-group">
                <label>Nome do Arquivo</label>
                <input type="text" id="l-fileName" value="${lesson.fileName || ''}" placeholder="Ex: material-apoio.pdf">
              </div>
              <div class="file-upload-area" onclick="showToast('Upload de PDF em breve!','upload')">
                ${Icons.upload(28)}
                <p>Fa√ßa upload do arquivo PDF</p>
                <span class="file-types">PDF at√© 50MB</span>
              </div>
            </div>

            <!-- Transcription (for video & text) -->
            <div class="admin-form-group full">
              <label>${Icons.edit(14)} Transcri√ß√£o</label>
              <textarea id="l-transcription" rows="4" placeholder="Cole ou digite a transcri√ß√£o da aula...">${lesson.transcription || ''}</textarea>
              <span class="help-text">Transcri√ß√£o completa do conte√∫do falado ou escrito</span>
            </div>

            <!-- Notes -->
            <div class="admin-form-group full">
              <label>${Icons.copy(14)} Notas da Aula</label>
              <textarea id="l-notes" rows="4" placeholder="Anota√ß√µes do instrutor, pontos-chave, resumos...">${lesson.notes || ''}</textarea>
              <span class="help-text">Notas de anota√ß√£o para os alunos</span>
            </div>
          </div>
        </div>
        <div class="admin-modal-footer">
          <button class="btn btn-ghost" onclick="closeLessonEditor()">Cancelar</button>
          <button class="btn btn-primary" onclick="saveLesson()">
            ${Icons.check(16)} ${isNew ? 'Adicionar Aula' : 'Salvar Aula'}
          </button>
        </div>
      `;

      const overlay = document.getElementById('lesson-overlay');
      overlay.classList.add('open');
    }

    function closeLessonEditor() {
      document.getElementById('lesson-overlay').classList.remove('open');
      editingLessonCtx = null;
    }

    function toggleLessonType() {
      const type = document.querySelector('input[name="l-type"]:checked').value;
      document.getElementById('lesson-video-fields').style.display = type === 'video' ? 'flex' : 'none';
      document.getElementById('lesson-text-fields').style.display = type === 'text' ? 'flex' : 'none';
      document.getElementById('lesson-pdf-fields').style.display = type === 'pdf' ? 'flex' : 'none';
    }

    function saveLesson() {
      const title = document.getElementById('l-title').value.trim();
      if (!title) { showToast('Informe o t√≠tulo da aula!', 'close'); return; }

      const type = document.querySelector('input[name="l-type"]:checked').value;
      const lesson = {
        title,
        type,
        videoUrl: document.getElementById('l-videoUrl')?.value || '',
        duration: document.getElementById('l-duration')?.value || '',
        content: document.getElementById('l-content')?.value || '',
        fileName: document.getElementById('l-fileName')?.value || '',
        fileSize: '',
        transcription: document.getElementById('l-transcription')?.value || '',
        notes: document.getElementById('l-notes')?.value || '',
      };

      const { sectionIdx, lessonIdx } = editingLessonCtx;
      let sections = getTempSections();

      if (lessonIdx === -1) {
        // New lesson
        const allIds = sections.flatMap(s => s.lessons.map(l => l.id || 0));
        lesson.id = allIds.length > 0 ? Math.max(...allIds) + 1 : 1;
        sections[sectionIdx].lessons.push(lesson);
        showToast('Aula adicionada!', 'check');
      } else {
        // Update existing
        lesson.id = sections[sectionIdx].lessons[lessonIdx].id;
        sections[sectionIdx].lessons[lessonIdx] = lesson;
        showToast('Aula atualizada!', 'check');
      }

      document.getElementById('course-builder').innerHTML = renderCourseSections({ sections });
      closeLessonEditor();
    }

    function saveCourse() {
      const title = document.getElementById('c-title').value.trim();
      const instructor = document.getElementById('c-instructor').value.trim();
      if (!title) { showToast('Informe o t√≠tulo do curso!', 'close'); return; }
      if (!instructor) { showToast('Informe o instrutor!', 'close'); return; }

      const sections = getTempSections();

      const data = {
        title,
        instructor,
        avatar: document.getElementById('c-avatar').value.trim() || title.charAt(0),
        price: parseFloat(document.getElementById('c-price').value) || 0,
        duration: document.getElementById('c-duration').value.trim(),
        level: document.getElementById('c-level').value,
        category: document.getElementById('c-category').value,
        modules: parseInt(document.getElementById('c-modules').value) || sections.reduce((s, sec) => s + sec.lessons.length, 0),
        status: document.getElementById('c-status').value,
        badge: document.getElementById('c-badge').value.trim(),
        description: document.getElementById('c-description').value.trim(),
        icon: document.getElementById('c-icon').value,
        gradient: document.getElementById('c-gradient').value,
        sections: sections,
        students: editingCourse ? (editingCourse.students || 0) : 0,
        rating: editingCourse ? (editingCourse.rating || 4.5) : 4.5,
      };

      if (editingCourse) {
        AdminStore.updateCourse(editingCourse.id, data);
        showToast('Curso atualizado com sucesso!', 'check');
      } else {
        AdminStore.addCourse(data);
        showToast('Curso criado com sucesso!', 'check');
      }

      window._tempSections = null;
      closeModal();
      renderMain();
    }

    function confirmDeleteCourse(id) {
      const c = AdminStore.getCourses().find(x => x.id === id);
      if (!c) return;
      if (confirm(`Excluir "${c.title}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
        AdminStore.deleteCourse(id);
        showToast('Curso exclu√≠do!', 'trash');
        renderMain();
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  RECIPES PAGE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderRecipesPage(el) {
      const recipes = AdminStore.getRecipes();
      el.innerHTML = `
        <div class="admin-topbar">
          <div>
            <h1>Receitas</h1>
            <p style="color:var(--text-muted);font-size:var(--font-size-sm);">${recipes.length} receitas cadastradas</p>
          </div>
          <div class="admin-topbar-actions">
            <div class="input-group" style="min-width:220px;">
              <span class="input-icon">${Icons.search(16)}</span>
              <input type="text" placeholder="Buscar receita..." id="recipe-search" oninput="filterRecipes()">
            </div>
            <button class="btn btn-primary" onclick="openRecipeModal()">
              ${Icons.plus(16)} Nova Receita
            </button>
          </div>
        </div>

        <div class="admin-table-wrapper" id="recipes-table-wrapper">
          ${renderRecipesTable(recipes)}
        </div>
      `;
    }

    function renderRecipesTable(recipes) {
      if (recipes.length === 0) {
        return `<div class="admin-empty">
          ${Icons.recipe(48)}
          <h3>Nenhuma receita cadastrada</h3>
          <p>Comece adicionando sua primeira receita.</p>
          <button class="btn btn-primary" onclick="openRecipeModal()">${Icons.plus(16)} Adicionar Receita</button>
        </div>`;
      }
      return `
        <table class="admin-table">
          <thead>
            <tr>
              <th>Receita</th>
              <th>Tempo</th>
              <th>Dificuldade</th>
              <th>Por√ß√µes</th>
              <th>Categoria</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            ${recipes.map(r => `
              <tr>
                <td>
                  <div class="td-product">
                    <div class="td-icon ${r.gradient || 'green'}">${Icons[r.icon] ? Icons[r.icon](20) : Icons.recipe(20)}</div>
                    <div>
                      <div class="td-name">${r.title}</div>
                      <div class="td-sub">${r.author || ''}</div>
                    </div>
                  </div>
                </td>
                <td>${r.time || '-'}</td>
                <td><span class="badge badge-green">${r.difficulty || '-'}</span></td>
                <td>${r.serves || '-'} por√ß√µes</td>
                <td><span class="badge badge-info" style="text-transform:capitalize;">${r.category || '-'}</span></td>
                <td><span class="status-badge ${r.status || 'active'}">${r.status === 'draft' ? 'Rascunho' : r.status === 'inactive' ? 'Inativo' : 'Ativo'}</span></td>
                <td class="td-actions">
                  <button class="admin-action-btn" onclick="openRecipeModal(${r.id})">${Icons.edit(14)}</button>
                  <button class="admin-action-btn" onclick="duplicateRecipe(${r.id})">${Icons.copy(14)}</button>
                  <button class="admin-action-btn danger" onclick="confirmDeleteRecipe(${r.id})">${Icons.trash(14)}</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function filterRecipes() {
      const q = (document.getElementById('recipe-search')?.value || '').toLowerCase();
      const recipes = AdminStore.getRecipes().filter(r =>
        r.title.toLowerCase().includes(q) ||
        (r.author || '').toLowerCase().includes(q) ||
        (r.category || '').toLowerCase().includes(q)
      );
      document.getElementById('recipes-table-wrapper').innerHTML = renderRecipesTable(recipes);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  RECIPE MODAL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function openRecipeModal(id) {
      editingRecipe = id ? AdminStore.getRecipes().find(r => r.id === id) : null;
      const r = editingRecipe || {};
      const isEdit = !!editingRecipe;
      const ingredientsList = (r.ingredients || []).join('\n');

      document.getElementById('modal-container').innerHTML = `
        <div class="admin-modal-header">
          <h2>${Icons.recipe(22)} ${isEdit ? 'Editar Receita' : 'Nova Receita'}</h2>
          <button class="admin-action-btn" onclick="closeModal()">${Icons.close(18)}</button>
        </div>
        <div class="admin-modal-body">
          <div class="admin-tabs" id="recipe-tabs">
            <button class="admin-tab active" onclick="switchRecipeTab('info')">Informa√ß√µes</button>
            <button class="admin-tab" onclick="switchRecipeTab('content')">Conte√∫do</button>
            <button class="admin-tab" onclick="switchRecipeTab('media')">M√≠dia</button>
          </div>

          <!-- Info Tab -->
          <div id="recipe-tab-info">
            <div class="admin-form-grid">
              <div class="admin-form-group full">
                <label>T√≠tulo da Receita <span class="required">*</span></label>
                <input type="text" id="r-title" value="${r.title || ''}" placeholder="Ex: Salada Org√¢nica Colorida">
              </div>
              <div class="admin-form-group">
                <label>Autor <span class="required">*</span></label>
                <input type="text" id="r-author" value="${r.author || ''}" placeholder="Ex: Chef Carolina">
              </div>
              <div class="admin-form-group">
                <label>Tempo de Preparo</label>
                <input type="text" id="r-time" value="${r.time || ''}" placeholder="Ex: 30 min, 1h 15min">
              </div>
              <div class="admin-form-group">
                <label>Dificuldade</label>
                <select id="r-difficulty">
                  ${DIFFICULTY_OPTIONS.map(d =>
                    `<option value="${d}" ${r.difficulty === d ? 'selected' : ''}>${d}</option>`
                  ).join('')}
                </select>
              </div>
              <div class="admin-form-group">
                <label>Por√ß√µes</label>
                <input type="number" id="r-serves" value="${r.serves || 4}" min="1">
              </div>
              <div class="admin-form-group">
                <label>Categoria</label>
                <select id="r-category">
                  ${RECIPE_CATEGORY_OPTIONS.map(c =>
                    `<option value="${c}" ${r.category === c ? 'selected' : ''}>${c.charAt(0).toUpperCase() + c.slice(1)}</option>`
                  ).join('')}
                </select>
              </div>
              <div class="admin-form-group">
                <label>Status</label>
                <select id="r-status">
                  <option value="active" ${(r.status||'active') === 'active' ? 'selected' : ''}>Ativo</option>
                  <option value="draft" ${r.status === 'draft' ? 'selected' : ''}>Rascunho</option>
                  <option value="inactive" ${r.status === 'inactive' ? 'selected' : ''}>Inativo</option>
                </select>
              </div>
              <div class="admin-form-group full">
                <label>Descri√ß√£o</label>
                <textarea id="r-description" rows="3" placeholder="Uma breve descri√ß√£o da receita...">${r.description || ''}</textarea>
              </div>
            </div>
          </div>

          <!-- Content Tab -->
          <div id="recipe-tab-content" style="display:none;">
            <div class="admin-form-grid">
              <div class="admin-form-group full">
                <label>${Icons.apple(14)} Ingredientes (um por linha)</label>
                <textarea id="r-ingredients" rows="8" placeholder="Mix de folhas org√¢nicas\\nTomate cereja\\nCenoura\\nAzeite extra virgem...">${ingredientsList}</textarea>
                <span class="help-text">Adicione cada ingrediente em uma nova linha</span>
              </div>
              <div class="admin-form-group full">
                <label>${Icons.edit(14)} Modo de Preparo</label>
                <textarea id="r-instructions" rows="10" placeholder="1. Lave e corte os vegetais...\\n2. Em uma panela...\\n3. Sirva quente...">${r.instructions || ''}</textarea>
                <span class="help-text">Descreva o passo a passo da receita</span>
              </div>
              <div class="admin-form-group full">
                <label>${Icons.copy(14)} Dicas e Notas</label>
                <textarea id="r-tips" rows="3" placeholder="Dicas extras, substitui√ß√µes, varia√ß√µes...">${r.tips || ''}</textarea>
              </div>
            </div>
          </div>

          <!-- Media Tab -->
          <div id="recipe-tab-media" style="display:none;">
            <div class="admin-form-grid">
              <div class="admin-form-group">
                <label>√çcone</label>
                <div style="display:flex;gap:var(--space-2);flex-wrap:wrap;">
                  ${ICON_OPTIONS.map(ic => `
                    <button type="button" class="admin-action-btn ricon-pick" data-icon="${ic}" onclick="pickRecipeIcon('${ic}')" style="${(r.icon||'recipe') === ic ? 'border-color:var(--green-primary);background:var(--green-light);color:var(--green-dark);' : ''}">
                      ${Icons[ic](18)}
                    </button>
                  `).join('')}
                </div>
                <input type="hidden" id="r-icon" value="${r.icon || 'recipe'}">
              </div>
              <div class="admin-form-group">
                <label>Cor / Gradiente</label>
                <div style="display:flex;gap:var(--space-2);flex-wrap:wrap;">
                  ${GRADIENT_OPTIONS.map(g => `
                    <button type="button" class="admin-action-btn rgrad-pick" data-gradient="${g}" onclick="pickRecipeGradient('${g}')" style="width:32px;height:32px;border-radius:50%;${(r.gradient||'green') === g ? 'box-shadow:0 0 0 2px var(--green-primary);' : ''}">
                      <div style="width:20px;height:20px;border-radius:50%;" class="img-placeholder ${g}"></div>
                    </button>
                  `).join('')}
                </div>
                <input type="hidden" id="r-gradient" value="${r.gradient || 'green'}">
              </div>
              <div class="admin-form-group full">
                <label>Foto da Receita</label>
                <div class="file-upload-area" onclick="showToast('Upload de imagens em breve!','upload')">
                  ${Icons.upload(32)}
                  <p>Clique para fazer upload</p>
                  <span class="file-types">PNG, JPG, WEBP at√© 5MB</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="admin-modal-footer">
          <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
          <button class="btn btn-primary" onclick="saveRecipe()">
            ${Icons.check(16)} ${isEdit ? 'Salvar Altera√ß√µes' : 'Criar Receita'}
          </button>
        </div>
      `;
      openModal();
    }

    function switchRecipeTab(tab) {
      ['info','content','media'].forEach(t => {
        document.getElementById('recipe-tab-' + t).style.display = t === tab ? 'block' : 'none';
      });
      document.querySelectorAll('#recipe-tabs .admin-tab').forEach((btn, i) => {
        btn.classList.toggle('active', ['info','content','media'][i] === tab);
      });
    }

    function pickRecipeIcon(icon) {
      document.getElementById('r-icon').value = icon;
      document.querySelectorAll('.ricon-pick').forEach(btn => {
        const isActive = btn.dataset.icon === icon;
        btn.style.borderColor = isActive ? 'var(--green-primary)' : '';
        btn.style.background = isActive ? 'var(--green-light)' : '';
        btn.style.color = isActive ? 'var(--green-dark)' : '';
      });
    }

    function pickRecipeGradient(gradient) {
      document.getElementById('r-gradient').value = gradient;
      document.querySelectorAll('.rgrad-pick').forEach(btn => {
        const isActive = btn.dataset.gradient === gradient;
        btn.style.boxShadow = isActive ? '0 0 0 2px var(--green-primary)' : 'none';
      });
    }

    function saveRecipe() {
      const title = document.getElementById('r-title').value.trim();
      const author = document.getElementById('r-author').value.trim();
      if (!title) { showToast('Informe o t√≠tulo da receita!', 'close'); return; }
      if (!author) { showToast('Informe o autor da receita!', 'close'); return; }

      const ingredientsRaw = document.getElementById('r-ingredients').value.trim();
      const ingredients = ingredientsRaw ? ingredientsRaw.split('\n').map(s => s.trim()).filter(Boolean) : [];

      const data = {
        title,
        author,
        time: document.getElementById('r-time').value.trim(),
        difficulty: document.getElementById('r-difficulty').value,
        serves: parseInt(document.getElementById('r-serves').value) || 4,
        category: document.getElementById('r-category').value,
        status: document.getElementById('r-status').value,
        description: document.getElementById('r-description').value.trim(),
        ingredients,
        instructions: document.getElementById('r-instructions')?.value.trim() || '',
        tips: document.getElementById('r-tips')?.value.trim() || '',
        icon: document.getElementById('r-icon').value,
        gradient: document.getElementById('r-gradient').value,
      };

      if (editingRecipe) {
        AdminStore.updateRecipe(editingRecipe.id, data);
        showToast('Receita atualizada com sucesso!', 'check');
      } else {
        AdminStore.addRecipe(data);
        showToast('Receita criada com sucesso!', 'check');
      }
      closeModal();
      renderMain();
    }

    function confirmDeleteRecipe(id) {
      const r = AdminStore.getRecipes().find(x => x.id === id);
      if (!r) return;
      if (confirm(`Excluir "${r.title}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
        AdminStore.deleteRecipe(id);
        showToast('Receita exclu√≠da!', 'trash');
        renderMain();
      }
    }

    function duplicateRecipe(id) {
      const r = AdminStore.getRecipes().find(x => x.id === id);
      if (!r) return;
      AdminStore.addRecipe({ ...r, title: r.title + ' (C√≥pia)', id: undefined, status: 'draft' });
      showToast('Receita duplicada como rascunho!', 'copy');
      renderMain();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ORDERS PAGE (placeholder)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderOrdersPage(el) {
      const orders = [
        { id: 1042, customer: 'Andr√© Machado', date: '15/01/2025', items: 3, total: 187.40, status: 'Enviado', statusColor: 'badge-info' },
        { id: 1041, customer: 'Maria silva', date: '08/01/2025', items: 5, total: 256.80, status: 'Entregue', statusColor: 'badge-green' },
        { id: 1040, customer: 'Jo√£o Souza', date: '05/01/2025', items: 2, total: 89.90, status: 'Entregue', statusColor: 'badge-green' },
        { id: 1039, customer: 'Ana Pereira', date: '02/01/2025', items: 7, total: 345.60, status: 'Entregue', statusColor: 'badge-green' },
        { id: 1038, customer: 'Carlos Ribeiro', date: '28/12/2024', items: 1, total: 42.50, status: 'Entregue', statusColor: 'badge-green' },
      ];
      el.innerHTML = `
        <div class="admin-topbar">
          <h1>Pedidos</h1>
        </div>
        <div class="admin-table-wrapper">
          <table class="admin-table">
            <thead>
              <tr><th>#</th><th>Cliente</th><th>Data</th><th>Itens</th><th>Total</th><th>Status</th></tr>
            </thead>
            <tbody>
              ${orders.map(o => `
                <tr>
                  <td><strong>#${o.id}</strong></td>
                  <td>${o.customer}</td>
                  <td>${o.date}</td>
                  <td>${o.items}</td>
                  <td><strong>${formatBRL(o.total)}</strong></td>
                  <td><span class="badge ${o.statusColor}">${o.status}</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  USERS MANAGEMENT PAGE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderUsersPage(el) {
      const users = AdminStore.getUsers();
      el.innerHTML = `
        <div class="admin-topbar">
          <div>
            <h1>Usu√°rios</h1>
            <p style="color:var(--text-muted);font-size:var(--font-size-sm);">${users.length} usu√°rios cadastrados ¬∑ ${users.filter(u => u.userRole === 'admin').length} admins</p>
          </div>
          <div class="admin-topbar-actions">
            <div class="input-group" style="min-width:220px;">
              <span class="input-icon">${Icons.search(16)}</span>
              <input type="text" placeholder="Buscar usu√°rio..." id="user-search" oninput="filterUsers()">
            </div>
            <select id="user-filter-role" onchange="filterUsers()" style="padding:var(--space-2) var(--space-4);border:1px solid var(--border-light);border-radius:var(--radius-full);background:var(--white);font-size:var(--font-size-sm);cursor:pointer;">
              <option value="">Todos os perfis</option>
              <option value="admin">Administradores</option>
              <option value="user">Usu√°rios</option>
            </select>
            <button class="btn btn-primary" onclick="openUserModal()">
              ${Icons.plus(16)} Novo Usu√°rio
            </button>
          </div>
        </div>

        <div class="admin-table-wrapper" id="users-table-wrapper">
          ${renderUsersTable(users)}
        </div>
      `;
    }

    function renderUsersTable(users) {
      if (users.length === 0) {
        return `<div class="admin-empty">
          ${Icons.users(48)}
          <h3>Nenhum usu√°rio cadastrado</h3>
          <p>Adicione o primeiro usu√°rio √† plataforma.</p>
          <button class="btn btn-primary" onclick="openUserModal()">${Icons.plus(16)} Adicionar Usu√°rio</button>
        </div>`;
      }
      return `
        <table class="admin-table">
          <thead>
            <tr>
              <th>Usu√°rio</th>
              <th>E-mail</th>
              <th>Fun√ß√£o</th>
              <th>Tipo</th>
              <th>Localiza√ß√£o</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            ${users.map(u => `
              <tr>
                <td>
                  <div class="td-product">
                    <div style="width:36px;height:36px;border-radius:50%;background:${u.userRole === 'admin' ? 'var(--green-primary)' : 'var(--green-light)'};display:flex;align-items:center;justify-content:center;font-weight:700;font-size:var(--font-size-xs);color:${u.userRole === 'admin' ? 'var(--white)' : 'var(--green-dark)'};">${u.avatar || u.name.charAt(0)}</div>
                    <div>
                      <div class="td-name">${u.name}</div>
                      <div class="td-sub">Desde ${u.createdAt || '-'}</div>
                    </div>
                  </div>
                </td>
                <td style="font-size:var(--font-size-sm);">${u.email || '-'}</td>
                <td style="font-size:var(--font-size-sm);">${u.role || '-'}</td>
                <td><span class="badge ${u.userRole === 'admin' ? 'badge-warning' : 'badge-green'}">${u.userRole === 'admin' ? 'üîí Admin' : 'üë§ Usu√°rio'}</span></td>
                <td style="font-size:var(--font-size-sm);">${u.location || '-'}</td>
                <td><span class="status-badge ${u.status || 'active'}">${u.status === 'blocked' ? 'Bloqueado' : u.status === 'inactive' ? 'Inativo' : 'Ativo'}</span></td>
                <td class="td-actions">
                  <button class="admin-action-btn" onclick="openUserModal(${u.id})">${Icons.edit(14)}</button>
                  ${u.userRole !== 'admin' ? `<button class="admin-action-btn danger" onclick="confirmDeleteUser(${u.id})">${Icons.trash(14)}</button>` : ''}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function filterUsers() {
      const q = (document.getElementById('user-search')?.value || '').toLowerCase();
      const roleFilter = document.getElementById('user-filter-role')?.value || '';
      let users = AdminStore.getUsers();
      if (q) {
        users = users.filter(u =>
          u.name.toLowerCase().includes(q) ||
          (u.email || '').toLowerCase().includes(q) ||
          (u.role || '').toLowerCase().includes(q) ||
          (u.location || '').toLowerCase().includes(q)
        );
      }
      if (roleFilter) {
        users = users.filter(u => u.userRole === roleFilter);
      }
      document.getElementById('users-table-wrapper').innerHTML = renderUsersTable(users);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  USER MODAL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function openUserModal(id) {
      editingUser = id ? AdminStore.getUsers().find(u => u.id === id) : null;
      const u = editingUser || {};
      const isEdit = !!editingUser;

      document.getElementById('modal-container').innerHTML = `
        <div class="admin-modal-header">
          <h2>${Icons.profile(22)} ${isEdit ? 'Editar Usu√°rio' : 'Novo Usu√°rio'}</h2>
          <button class="admin-action-btn" onclick="closeModal()">${Icons.close(18)}</button>
        </div>
        <div class="admin-modal-body">
          <div class="admin-form-grid">
            <div class="admin-form-group">
              <label>Nome Completo <span class="required">*</span></label>
              <input type="text" id="u-name" value="${u.name || ''}" placeholder="Nome do usu√°rio">
            </div>
            <div class="admin-form-group">
              <label>E-mail <span class="required">*</span></label>
              <input type="email" id="u-email" value="${u.email || ''}" placeholder="email@exemplo.com">
            </div>
            <div class="admin-form-group">
              <label>Fun√ß√£o / Cargo</label>
              <input type="text" id="u-role" value="${u.role || ''}" placeholder="Ex: Produtor, Educador...">
            </div>
            <div class="admin-form-group">
              <label>Localiza√ß√£o</label>
              <input type="text" id="u-location" value="${u.location || ''}" placeholder="Ex: Campinas-SP">
            </div>
            <div class="admin-form-group">
              <label>Iniciais do Avatar</label>
              <input type="text" id="u-avatar" value="${u.avatar || ''}" placeholder="Ex: MS" maxlength="3">
            </div>
            <div class="admin-form-group">
              <label>Tipo de Perfil</label>
              <select id="u-userRole">
                <option value="user" ${(u.userRole||'user') === 'user' ? 'selected' : ''}>Usu√°rio</option>
                <option value="admin" ${u.userRole === 'admin' ? 'selected' : ''}>Administrador</option>
              </select>
            </div>
            <div class="admin-form-group">
              <label>Categoria</label>
              <select id="u-category">
                ${USER_CATEGORY_OPTIONS.map(c =>
                  `<option value="${c}" ${u.category === c ? 'selected' : ''}>${c.charAt(0).toUpperCase() + c.slice(1)}</option>`
                ).join('')}
              </select>
            </div>
            <div class="admin-form-group">
              <label>Status</label>
              <select id="u-status">
                <option value="active" ${(u.status||'active') === 'active' ? 'selected' : ''}>Ativo</option>
                <option value="inactive" ${u.status === 'inactive' ? 'selected' : ''}>Inativo</option>
                <option value="blocked" ${u.status === 'blocked' ? 'selected' : ''}>Bloqueado</option>
              </select>
            </div>
            <div class="admin-form-group full">
              <label>Bio / Descri√ß√£o</label>
              <textarea id="u-bio" rows="3" placeholder="Breve descri√ß√£o do usu√°rio...">${u.bio || ''}</textarea>
            </div>
            <div class="admin-form-group full">
              <label>Especialidades (separadas por v√≠rgula)</label>
              <input type="text" id="u-specialties" value="${(u.specialties || []).join(', ')}" placeholder="Ex: Hortali√ßas, Educa√ß√£o Ambiental, Mel...">
            </div>
            ${!isEdit ? `
            <div class="admin-form-group">
              <label>Senha Inicial</label>
              <input type="password" id="u-password" placeholder="M√≠nimo 8 caracteres" minlength="8">
            </div>
            ` : ''}
          </div>
        </div>
        <div class="admin-modal-footer">
          <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
          <button class="btn btn-primary" onclick="saveUser()">
            ${Icons.check(16)} ${isEdit ? 'Salvar Altera√ß√µes' : 'Criar Usu√°rio'}
          </button>
        </div>
      `;
      openModal();
    }

    function saveUser() {
      const name = document.getElementById('u-name').value.trim();
      const email = document.getElementById('u-email').value.trim();
      if (!name) { showToast('Informe o nome do usu√°rio!', 'close'); return; }
      if (!email) { showToast('Informe o e-mail!', 'close'); return; }

      const specialtiesRaw = document.getElementById('u-specialties').value.trim();
      const specialties = specialtiesRaw ? specialtiesRaw.split(',').map(s => s.trim()).filter(Boolean) : [];

      const data = {
        name,
        email,
        role: document.getElementById('u-role').value.trim(),
        location: document.getElementById('u-location').value.trim(),
        avatar: document.getElementById('u-avatar').value.trim() || name.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase(),
        userRole: document.getElementById('u-userRole').value,
        category: document.getElementById('u-category').value,
        status: document.getElementById('u-status').value,
        bio: document.getElementById('u-bio').value.trim(),
        specialties,
      };

      if (editingUser) {
        AdminStore.updateUser(editingUser.id, data);
        showToast('Usu√°rio atualizado com sucesso!', 'check');
      } else {
        AdminStore.addUser(data);
        showToast('Usu√°rio criado com sucesso!', 'check');
      }
      closeModal();
      renderMain();
    }

    function confirmDeleteUser(id) {
      const u = AdminStore.getUsers().find(x => x.id === id);
      if (!u) return;
      if (u.userRole === 'admin') {
        showToast('N√£o √© poss√≠vel excluir administradores!', 'close');
        return;
      }
      if (confirm(`Excluir o usu√°rio "${u.name}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
        AdminStore.deleteUser(id);
        showToast('Usu√°rio exclu√≠do!', 'trash');
        renderMain();
      }
    }

    function toggleUserStatus(id) {
      const u = AdminStore.getUsers().find(x => x.id === id);
      if (!u) return;
      const newStatus = u.status === 'active' ? 'blocked' : 'active';
      AdminStore.updateUser(id, { status: newStatus });
      showToast(`Usu√°rio ${newStatus === 'active' ? 'ativado' : 'bloqueado'}!`, newStatus === 'active' ? 'check' : 'lock');
      renderMain();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MEMBERS PAGE (read-only view)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderMembersPage(el) {
      const members = window.MEMBERS || [];
      el.innerHTML = `
        <div class="admin-topbar">
          <h1>Integrantes</h1>
        </div>
        <div class="admin-table-wrapper">
          <table class="admin-table">
            <thead>
              <tr><th>Membro</th><th>Fun√ß√£o</th><th>Localiza√ß√£o</th><th>Categoria</th><th>Anos</th></tr>
            </thead>
            <tbody>
              ${members.map(m => `
                <tr>
                  <td>
                    <div class="td-product">
                      <div style="width:36px;height:36px;border-radius:50%;background:var(--green-light);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:var(--font-size-xs);color:var(--green-dark);">${m.avatar}</div>
                      <strong>${m.name}</strong>
                    </div>
                  </td>
                  <td>${m.role}</td>
                  <td>${m.location}</td>
                  <td><span class="badge badge-green">${m.category}</span></td>
                  <td>${m.years} anos</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MODAL HELPERS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function openModal() {
      document.getElementById('modal-overlay').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('modal-overlay').classList.remove('open');
      document.body.style.overflow = '';
      editingProduct = null;
      editingCourse = null;
      editingRecipe = null;
      editingUser = null;
      window._tempSections = null;
    }

    // Close on overlay click
    document.getElementById('modal-overlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) closeModal();
    });
    document.getElementById('lesson-overlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) closeLessonEditor();
    });

    // ESC to close
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (document.getElementById('lesson-overlay').classList.contains('open')) {
          closeLessonEditor();
        } else if (document.getElementById('modal-overlay').classList.contains('open')) {
          closeModal();
        }
      }
    });

    // ‚îÄ‚îÄ Mobile sidebar toggle ‚îÄ‚îÄ
    function toggleAdminSidebar() {
      document.getElementById('admin-sidebar').classList.toggle('open');
    }

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    renderSidebar();
    renderMain();
  </script>
</body>
</html>
