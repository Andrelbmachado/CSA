<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrinho â€” CSA</title>
  <link rel="stylesheet" href="css/variables.css?v=20260301">
  <link rel="stylesheet" href="css/styles.css?v=20260301">
  <link rel="stylesheet" href="css/icons.css?v=20260301">
  <link rel="stylesheet" href="css/components.css?v=20260301">
  <link rel="stylesheet" href="css/home.css?v=20260301">
  <link rel="stylesheet" href="css/pages.css?v=20260301">
  <link rel="stylesheet" href="css/animations.css?v=20260301">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒ±</text></svg>">
</head>
<body>
  <div id="app-header"></div>

  <section class="page-hero">
    <div class="container">
      <div class="breadcrumb">
        <a href="index.html">InÃ­cio</a>
        <span class="sep">/</span>
        <span>Carrinho</span>
      </div>
      <h1>Seu <span>Carrinho</span></h1>
      <p>Revise seus itens antes de finalizar a compra.</p>
    </div>
  </section>

  <main class="page-section">
    <div class="container">
      <div class="cart-layout" id="cart-layout"></div>
      <div class="empty-state" id="empty-cart" style="display:none;">
        <div id="empty-icon"></div>
        <h3>Seu carrinho estÃ¡ vazio</h3>
        <p>Explore nosso marketplace e adicione produtos frescos ao seu carrinho.</p>
        <a href="marketplace.html" class="btn btn-primary" style="margin-top:var(--space-4);">Ir para o Marketplace</a>
      </div>
    </div>
  </main>

  <div id="app-footer"></div>

  <script src="js/icons.js?v=20260301"></script>
  <script src="js/data.js?v=20260301"></script>
  <script src="js/app.js?v=20260301"></script>
  <script>
    document.getElementById('app-header').innerHTML = renderHeader('');
    document.getElementById('app-footer').innerHTML = renderFooter();
    document.getElementById('empty-icon').innerHTML = Icons.cart(56);
    initNotifications();

    function renderCart() {
      const cart = window.CSA.cart;
      const layout = document.getElementById('cart-layout');
      const emptyEl = document.getElementById('empty-cart');

      if (cart.length === 0) {
        layout.style.display = 'none';
        emptyEl.style.display = 'block';
        return;
      }

      layout.style.display = 'grid';
      emptyEl.style.display = 'none';

      const subtotal = getCartTotal();
      const shipping = subtotal > 100 ? 0 : 12.90;
      const total = subtotal + shipping;

      layout.innerHTML = `
        <div class="cart-items">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-4);">
            <h3 style="font-size:var(--font-size-lg);">Itens (${cart.reduce((s,i)=>s+i.qty,0)})</h3>
            <div class="cart-select-all">
              <label>
                <input type="checkbox" id="select-all-cart" onchange="toggleSelectAll(this.checked)" checked>
                Selecionar todos
              </label>
            </div>
          </div>
          ${cart.map(item => {
            const product = window.PRODUCTS.find(p => p.id === item.id);
            return `
            <div class="cart-item fade-in-up selected" data-item-id="${item.id}">
              <div class="cart-item-check">
                <input type="checkbox" checked onchange="toggleCartItem(${item.id}, this.checked)">
              </div>
              <div class="cart-item-image img-placeholder ${item.gradient || 'green'}">
                ${Icons[item.icon || 'apple'](40)}
              </div>
              <div class="cart-item-info">
                <h4><a href="produto.html?id=${item.id}">${item.name}</a></h4>
                <p class="cart-item-price">${formatBRL(item.price)} ${product ? product.unit : '/unid'}</p>
              </div>
              <div class="cart-item-qty">
                <button onclick="modifyQty(${item.id}, -1)">âˆ’</button>
                <span>${item.qty}</span>
                <button onclick="modifyQty(${item.id}, 1)">+</button>
              </div>
              <div class="cart-item-total">${formatBRL(item.price * item.qty)}</div>
              <button class="cart-item-remove" onclick="removeItem(${item.id})">
                ${Icons.trash(18)}
              </button>
            </div>`;
          }).join('')}
        </div>

        <div class="cart-summary scale-in">
          <h3>Resumo do Pedido</h3>
          <div class="cart-summary-row">
            <span>Subtotal</span>
            <span>${formatBRL(subtotal)}</span>
          </div>
          <div class="cart-summary-row">
            <span>Frete</span>
            <span>${shipping === 0 ? '<span style="color:var(--success);font-weight:600;">GrÃ¡tis</span>' : formatBRL(shipping)}</span>
          </div>
          ${shipping > 0 ? `<p style="font-size:var(--font-size-xs);color:var(--text-muted);margin-top:var(--space-1);">Frete grÃ¡tis para pedidos acima de R$ 100,00</p>` : ''}
          <div class="cart-summary-row total">
            <span>Total</span>
            <span>${formatBRL(total)}</span>
          </div>
          <div class="cart-coupon">
            <input type="text" placeholder="Cupom de desconto" id="coupon-input">
            <button class="btn btn-outline btn-sm" onclick="applyCoupon()">Aplicar</button>
          </div>
          <button class="btn btn-primary btn-lg btn-pulse" onclick="checkout()">
            ${Icons.check(20)} Finalizar Compra
          </button>
          <a href="marketplace.html" class="btn btn-ghost" style="width:100%;margin-top:var(--space-2);">
            ${Icons.arrowLeft(16)} Continuar Comprando
          </a>
        </div>
      `;
      setTimeout(initScrollAnimations, 50);
    }

    function modifyQty(id, delta) {
      updateCartQty(id, delta);
      renderCart();
    }

    function removeItem(id) {
      removeFromCart(id);
      renderCart();
      showToast('Item removido do carrinho', 'trash');
    }

    function applyCoupon() {
      const code = document.getElementById('coupon-input').value.trim();
      if (code.toUpperCase() === 'CSA10') {
        showToast('Cupom CSA10 aplicado! 10% de desconto.', 'check');
      } else if (code) {
        showToast('Cupom invÃ¡lido. Tente CSA10.', 'close');
      }
    }

    function toggleCartItem(id, checked) {
      const el = document.querySelector(`.cart-item[data-item-id="${id}"]`);
      if (el) {
        el.classList.toggle('selected', checked);
      }
      // Update select-all checkbox state
      const allBoxes = document.querySelectorAll('.cart-item-check input[type="checkbox"]');
      const allChecked = [...allBoxes].every(cb => cb.checked);
      const selectAll = document.getElementById('select-all-cart');
      if (selectAll) selectAll.checked = allChecked;
    }

    function toggleSelectAll(checked) {
      document.querySelectorAll('.cart-item-check input[type="checkbox"]').forEach(cb => {
        cb.checked = checked;
        const item = cb.closest('.cart-item');
        if (item) item.classList.toggle('selected', checked);
      });
    }

    function checkout() {
      showToast('Pedido realizado com sucesso! Obrigado pela compra.', 'check');
      window.CSA.cart = [];
      saveCart();
      setTimeout(renderCart, 1500);
    }

    renderCart();
  </script>
</body>
</html>
